<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Foot Care Training</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family:Arial;
    background:#f4f6f8;
    margin:0;
    padding:20px;
    transition:0.3s;
}
body.dark{
    background:#121212;
    color:white;
}

h2{text-align:center;}
.container{max-width:1100px;margin:auto;}

.cards{display:flex;gap:20px;justify-content:center;margin-bottom:20px;}
.card{
    background:white;
    border-radius:12px;
    padding:20px;
    width:220px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    transition:0.3s;
}
body.dark .card{background:#1e1e1e;}

.big{font-size:26px;font-weight:bold;margin:10px 0;}

button{
    background:#007bff;color:white;border:none;
    padding:8px 12px;border-radius:8px;cursor:pointer;margin:5px;
}
button:hover{background:#0056b3;}

.timer{text-align:center;font-size:24px;margin:20px 0;}

.xyz-box{
    display:flex;gap:15px;justify-content:center;margin-top:10px;
}
.xyz{
    background:white;padding:15px;border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    width:100px;text-align:center;transition:0.3s;
}
body.dark .xyz{background:#1e1e1e;}

.status{
    text-align:center;
    font-size:20px;
    font-weight:bold;
    margin-top:10px;
}

.summary-values{
    text-align:center;
    margin-top:30px;
    font-size:18px;
    font-weight:bold;
}

canvas{
    background:white;
    margin-top:20px;
    padding:10px;
    border-radius:12px;
    transition:0.3s;
}
body.dark canvas{background:#1e1e1e;}
</style>
</head>

<body>
<div class="container">
<h2>Foot Care Training</h2>

<div style="text-align:center;margin-bottom:20px;">
<button onclick="toggleDarkMode()">üåô Dark Mode</button>
</div>

<div class="status">
‡πÄ‡∏ã‡∏ï‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="currentSetText">1</span> / 5
</div>

<div class="cards">
    <div class="card">
        <div>Dorsi</div>
        <div class="big" id="dorsiVal">0</div>
        <button onclick="startTraining('dorsi')">Start Dorsi</button>
    </div>

    <div class="card">
        <div>Plantar</div>
        <div class="big" id="plantarVal">0</div>
        <button onclick="startTraining('plantar')">Start Plantar</button>
    </div>
</div>

<div class="xyz-box">
    <div class="xyz">X<br><span id="xVal">0</span></div>
    <div class="xyz">Y<br><span id="yVal">0</span></div>
    <div class="xyz">Z<br><span id="zVal">0</span></div>
</div>

<div class="timer">
‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤: <span id="timer">30</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
</div>

<div class="summary-values">
‡πÄ‡∏ã‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí 
Dorsi Max: <span id="sumDorsi">0</span> | 
Plantar Max: <span id="sumPlantar">0</span> | 
ROM: <span id="sumROM">0</span>
</div>

<canvas id="liveChart" height="120"></canvas>
<canvas id="summaryChart" height="140"></canvas>

</div>

<script>
let timerEl=document.getElementById("timer");
let dorsiVal=document.getElementById("dorsiVal");
let plantarVal=document.getElementById("plantarVal");
let xVal=document.getElementById("xVal");
let yVal=document.getElementById("yVal");
let zVal=document.getElementById("zVal");

let sumDorsi=document.getElementById("sumDorsi");
let sumPlantar=document.getElementById("sumPlantar");
let sumROM=document.getElementById("sumROM");
let currentSetText=document.getElementById("currentSetText");

let interval;
let timeLeft=30;
let currentSet=0;
let maxDorsi=0;
let maxPlantar=0;

const colors=["#ff6384","#36a2eb","#ffce56","#4bc0c0","#9966ff"];

const liveChart=new Chart(document.getElementById("liveChart"),{
    type:"line",
    data:{labels:[],datasets:[
        {label:"Value",data:[],borderWidth:2}
    ]}
});

const summaryChart=new Chart(document.getElementById("summaryChart"),{
    type:"bar",
    data:{labels:["Dorsi Max","Plantar Max","ROM"],datasets:[]}
});

function toggleDarkMode(){
    document.body.classList.toggle("dark");
}

function resetXYZ(){
    xVal.innerText=0;
    yVal.innerText=0;
    zVal.innerText=0;
}

function clearLiveChart(){
    liveChart.data.labels=[];
    liveChart.data.datasets[0].data=[];
    liveChart.update();
}

function simulateMPU(){
    let x=Math.random()*40-20;
    let y=Math.random()*50-25;
    let z=Math.random()*30-15;

    xVal.innerText=x.toFixed(1);
    yVal.innerText=y.toFixed(1);
    zVal.innerText=z.toFixed(1);

    return {x,y,z};
}

function startTraining(type){
    if(currentSet>=5){
        alert("‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏£‡∏ö 5 ‡πÄ‡∏ã‡∏ï‡πÅ‡∏•‡πâ‡∏ß");
        return;
    }

    clearInterval(interval);
    clearLiveChart();

    timeLeft=30;
    timerEl.innerText=timeLeft;

    maxDorsi=0;
    maxPlantar=0;

    interval=setInterval(()=>{
        timeLeft--;
        timerEl.innerText=timeLeft;

        let {x,y,z}=simulateMPU();
        let value=(type==="dorsi")?x:y;

        if(type==="dorsi"){
            dorsiVal.innerText=value.toFixed(1);
            if(Math.abs(value)>maxDorsi) maxDorsi=Math.abs(value);
        }else{
            plantarVal.innerText=value.toFixed(1);
            if(Math.abs(value)>maxPlantar) maxPlantar=Math.abs(value);
        }

        liveChart.data.labels.push(30-timeLeft);
        liveChart.data.datasets[0].data.push(value);
        liveChart.update();

        if(timeLeft<=0){
            clearInterval(interval);
            finishSet();
        }
    },1000);
}

function finishSet(){
    let rom=maxDorsi+maxPlantar;

    sumDorsi.innerText=maxDorsi.toFixed(1);
    sumPlantar.innerText=maxPlantar.toFixed(1);
    sumROM.innerText=rom.toFixed(1);

    summaryChart.data.datasets.push({
        label:"‡πÄ‡∏ã‡∏ï "+(currentSet+1),
        data:[maxDorsi,maxPlantar,rom],
        backgroundColor:colors[currentSet]
    });

    summaryChart.update();

    currentSet++;
    currentSetText.innerText=currentSet+1>5?5:currentSet+1;

    resetXYZ();
}
</script>

</body>
</html>
