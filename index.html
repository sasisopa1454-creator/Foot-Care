<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ankle Rehab Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    overflow:hidden;
    transition:0.3s;
}

.light{ background:#f2f2f2; color:#000; }
.dark{ background:#1e1e1e; color:#fff; }

.wrapper{
    height:100vh;
    display:flex;
    flex-direction:column;
    padding:6px;
    box-sizing:border-box;
}

/* ===== TOP ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô ===== */
.top{
    display:flex;
    justify-content:space-around;
    align-items:center;
    height:20%;
}

.box{
    border:1.5px solid #333;
    border-radius:8px;
    padding:6px;
    width:140px;
    font-size:13px;
    text-align:center;
    background:white;
}

.dark .box{
    background:#333;
    border-color:#aaa;
}

.valueRow{
    display:flex;
    justify-content:space-between;
    font-size:13px;
}

button{
    margin-top:5px;
    padding:4px 8px;
    font-size:11px;
    cursor:pointer;
}

/* ===== CHART ===== */
.middle{
    display:flex;
    flex:1;
    gap:10px;
}

.chartBox{
    flex:1;
    background:white;
    padding:8px;
    border-radius:12px;
}

.dark .chartBox{
    background:#2b2b2b;
}

canvas{
    height:100% !important;
}
</style>
</head>

<body class="light">
<div class="wrapper">

<h3 id="statusText">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</h3>
<h3 id="timerText">‡πÄ‡∏ß‡∏•‡∏≤: 0 ‡∏ß‡∏¥</h3>

<div class="top">

    <!-- Dorsi -->
    <div class="box">
        <b>Dorsi</b>
        <div id="dorsi">0¬∞</div>
        <div id="dorsiCount">1 / 5</div>
        <button onclick="startMode('dorsi')">Start</button>
    </div>

    <!-- Plantar -->
    <div class="box">
        <b>Plantar</b>
        <div id="plantar">0¬∞</div>
        <div id="plantarCount">1 / 5</div>
        <button onclick="startMode('plantar')">Start</button>
    </div>

    <!-- XYZ ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô -->
    <div class="box">
        <b>MPU</b>
        <div class="valueRow">
            <div>X: <span id="xVal">0</span></div>
            <div>Y: <span id="yVal">0</span></div>
            <div>Z: <span id="zVal">0</span></div>
        </div>
    </div>

    <div class="box">
        <button onclick="toggleMode()">üåô / ‚òÄÔ∏è</button>
    </div>

</div>

<div class="middle">
    <div class="chartBox">
        <canvas id="dorsiChart"></canvas>
    </div>
    <div class="chartBox">
        <canvas id="plantarChart"></canvas>
    </div>
</div>

</div>

<script>

let duration=30;
let timer;
let running=false;
let mode=null;

let dorsiSet=1;
let plantarSet=1;

let colors=["red","blue","green","orange","purple"];

const dorsiChart=new Chart(document.getElementById("dorsiChart"),{
    type:'line',
    data:{ labels:[], datasets:[] },
    options:{ responsive:true, maintainAspectRatio:false }
});

const plantarChart=new Chart(document.getElementById("plantarChart"),{
    type:'line',
    data:{ labels:[], datasets:[] },
    options:{ responsive:true, maintainAspectRatio:false }
});

function startMode(selectedMode){

    if(running) return;

    if(selectedMode==="dorsi" && dorsiSet>5){
        alert("Dorsi ‡∏Ñ‡∏£‡∏ö 5 ‡πÄ‡∏ã‡∏ï‡πÅ‡∏•‡πâ‡∏ß");
        return;
    }

    if(selectedMode==="plantar" && plantarSet>5){
        alert("Plantar ‡∏Ñ‡∏£‡∏ö 5 ‡πÄ‡∏ã‡∏ï‡πÅ‡∏•‡πâ‡∏ß");
        return;
    }

    mode=selectedMode;
    running=true;

    let timeLeft=duration;
    let dataArray=[];
    let labels=[];

    document.getElementById("statusText").innerText=
        "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ù‡∏∂‡∏Å: "+mode.toUpperCase();

    document.getElementById("timerText").innerText=
        "‡πÄ‡∏ß‡∏•‡∏≤: "+duration+" ‡∏ß‡∏¥";

    timer=setInterval(()=>{

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ MPU ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        let x=(Math.random()*20-10).toFixed(2);
        let y=(Math.random()*20-10).toFixed(2);
        let z=(Math.random()*20-10).toFixed(2);

        document.getElementById("xVal").innerText=x;
        document.getElementById("yVal").innerText=y;
        document.getElementById("zVal").innerText=z;

        let angle=parseFloat(y);

        if(mode==="dorsi"){
            angle=Math.max(0,angle);
            document.getElementById("dorsi").innerText=angle.toFixed(1)+"¬∞";
        }else{
            angle=Math.abs(Math.min(0,angle));
            document.getElementById("plantar").innerText=angle.toFixed(1)+"¬∞";
        }

        labels.push(duration-timeLeft);
        dataArray.push(angle);

        timeLeft--;
        document.getElementById("timerText").innerText=
            "‡πÄ‡∏ß‡∏•‡∏≤: "+timeLeft+" ‡∏ß‡∏¥";

        if(timeLeft<=0){
            stopMode(labels,dataArray);
        }

    },1000);
}

function stopMode(labels,dataArray){

    clearInterval(timer);
    running=false;

    let dataset={
        label: mode+" Set "+(mode==="dorsi"?dorsiSet:plantarSet),
        data:dataArray,
        borderColor: colors[(mode==="dorsi"?dorsiSet:plantarSet)-1],
        fill:false,
        tension:0.3
    };

    if(mode==="dorsi"){
        dorsiChart.data.labels=labels;
        dorsiChart.data.datasets.push(dataset);
        dorsiChart.update();
        dorsiSet++;
        document.getElementById("dorsiCount").innerText=dorsiSet+" / 5";
    }else{
        plantarChart.data.labels=labels;
        plantarChart.data.datasets.push(dataset);
        plantarChart.update();
        plantarSet++;
        document.getElementById("plantarCount").innerText=plantarSet+" / 5";
    }

    document.getElementById("statusText").innerText="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô";
    document.getElementById("timerText").innerText="‡πÄ‡∏ß‡∏•‡∏≤: 0 ‡∏ß‡∏¥";

    document.getElementById("xVal").innerText=0;
    document.getElementById("yVal").innerText=0;
    document.getElementById("zVal").innerText=0;
    document.getElementById("dorsi").innerText="0¬∞";
    document.getElementById("plantar").innerText="0¬∞";
}

function toggleMode(){
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
}

</script>
</body>
</html>
