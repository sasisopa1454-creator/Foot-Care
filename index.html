<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ankle Rehab Monitor</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#f2f2f2;
    overflow:hidden;
}

.wrapper{
    height:100vh;
    display:flex;
    flex-direction:column;
    padding:10px;
    box-sizing:border-box;
}

.top{
    display:flex;
    justify-content:space-around;
    align-items:center;
}

.box{
    border:2px solid #333;
    border-radius:8px;
    padding:8px;
    width:90px;
    text-align:center;
    background:white;
}

.white{
    background:white;
}

h2,h3{
    margin:5px;
}

button{
    padding:6px 15px;
    font-size:14px;
}

.middle{
    display:flex;
    flex:1;
    gap:10px;
}

.chartBox{
    flex:1;
    background:white;
    padding:5px;
    border-radius:10px;
}

canvas{
    height:100% !important;
}
</style>
</head>

<body>

<div class="wrapper">

    <h3 id="setText">Set 1 / 5</h3>

    <div class="top">
        <div class="box">
            <h3>Dorsi</h3>
            <div id="dorsi">0¬∞</div>
        </div>

        <div class="box">
            <h3>Plantar</h3>
            <div id="plantar">0¬∞</div>
        </div>

        <div class="box white">
            <h3>X</h3>
            <div id="xVal">0</div>
        </div>

        <div class="box white">
            <h3>Y</h3>
            <div id="yVal">0</div>
        </div>

        <div class="box white">
            <h3>Z</h3>
            <div id="zVal">0</div>
        </div>

        <button onclick="startSet()">Start</button>
    </div>

    <div class="middle">
        <div class="chartBox">
            <canvas id="realtimeChart"></canvas>
        </div>

        <div class="chartBox">
            <canvas id="romChart"></canvas>
        </div>
    </div>

</div>

<script>

let running=false;
let currentSet=1;
let maxSet=5;
let duration=30;
let timer;

let dorsiMin,dorsiMax,plantarMin,plantarMax;

let colors=["red","blue","green","orange","purple"];

const realtimeChart=new Chart(document.getElementById("realtimeChart"),{
    type:'line',
    data:{
        labels:[],
        datasets:[
            {label:'Dorsi',data:[],borderColor:'blue',fill:false},
            {label:'Plantar',data:[],borderColor:'red',fill:false}
        ]
    },
    options:{responsive:true,maintainAspectRatio:false}
});

const romChart=new Chart(document.getElementById("romChart"),{
    type:'bar',
    data:{
        labels:["Dorsi ROM","Plantar ROM"],
        datasets:[]
    },
    options:{responsive:true,maintainAspectRatio:false}
});

function startSet(){

    if(currentSet>maxSet){
        alert("‡∏Ñ‡∏£‡∏ö 5 ‡πÄ‡∏ã‡∏ï‡πÅ‡∏•‡πâ‡∏ß");
        return;
    }

    running=true;

    document.getElementById("setText").innerText=
        "Set "+currentSet+" / 5";

    realtimeChart.data.labels=[];
    realtimeChart.data.datasets[0].data=[];
    realtimeChart.data.datasets[1].data=[];
    realtimeChart.update();

    dorsiMin=999; dorsiMax=-999;
    plantarMin=999; plantarMax=-999;

    document.getElementById("xVal").innerText=0;
    document.getElementById("yVal").innerText=0;
    document.getElementById("zVal").innerText=0;

    let t=0;

    timer=setInterval(()=>{

        if(!running) return;

        // üîπ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å MPU ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        let x=(Math.random()*20-10).toFixed(2);
        let y=(Math.random()*20-10).toFixed(2);
        let z=(Math.random()*20-10).toFixed(2);

        let dorsi=Math.max(0,y);
        let plantar=Math.abs(Math.min(0,y));

        document.getElementById("xVal").innerText=x;
        document.getElementById("yVal").innerText=y;
        document.getElementById("zVal").innerText=z;

        document.getElementById("dorsi").innerText=dorsi.toFixed(1)+"¬∞";
        document.getElementById("plantar").innerText=plantar.toFixed(1)+"¬∞";

        realtimeChart.data.labels.push(t);
        realtimeChart.data.datasets[0].data.push(dorsi);
        realtimeChart.data.datasets[1].data.push(plantar);
        realtimeChart.update();

        if(dorsi<dorsiMin) dorsiMin=dorsi;
        if(dorsi>dorsiMax) dorsiMax=dorsi;
        if(plantar<plantarMin) plantarMin=plantar;
        if(plantar>plantarMax) plantarMax=plantar;

        t++;

        if(t>=duration){
            stopSet();
        }

    },1000);
}

function stopSet(){

    clearInterval(timer);
    running=false;

    let dorsiROM=(dorsiMax-dorsiMin).toFixed(2);
    let plantarROM=(plantarMax-plantarMin).toFixed(2);

    romChart.data.datasets.push({
        label:"Set "+currentSet,
        data:[dorsiROM,plantarROM],
        backgroundColor:colors[currentSet-1]
    });

    romChart.update();

    document.getElementById("xVal").innerText=0;
    document.getElementById("yVal").innerText=0;
    document.getElementById("zVal").innerText=0;
    document.getElementById("dorsi").innerText="0¬∞";
    document.getElementById("plantar").innerText="0¬∞";

    currentSet++;
}

</script>

</body>
</html>
