<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Foot Care Training</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family:Arial;
    background:#f4f6f8;
    margin:0;
    padding:20px;
    transition:0.3s;
}
body.dark{
    background:#121212;
    color:white;
}

h2{text-align:center;}

.container{max-width:1100px;margin:auto;}

.cards{display:flex;gap:20px;justify-content:center;margin-bottom:20px;}
.card{
    background:white;
    border-radius:12px;
    padding:20px;
    width:200px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    transition:0.3s;
}
body.dark .card{
    background:#1e1e1e;
}

.big{font-size:28px;font-weight:bold;margin:10px 0;}

button{
    background:#007bff;color:white;border:none;
    padding:8px 12px;border-radius:8px;cursor:pointer;
    margin:5px;
}
button:hover{background:#0056b3;}

.timer{text-align:center;font-size:24px;margin:20px 0;}

.xyz-box{
    display:flex;
    gap:15px;
    justify-content:center;
    margin-top:10px;
}

.xyz{
    background:white;
    padding:15px;
    border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    width:100px;
    text-align:center;
    transition:0.3s;
}
body.dark .xyz{
    background:#1e1e1e;
}

table{
    width:100%;
    border-collapse:collapse;
    background:white;
    margin-top:20px;
    transition:0.3s;
}
body.dark table{
    background:#1e1e1e;
}
th,td{
    border:1px solid #ccc;
    padding:10px;
    text-align:center;
}
th{background:#007bff;color:white;}

canvas{
    background:white;
    margin-top:30px;
    padding:10px;
    border-radius:12px;
    transition:0.3s;
}
body.dark canvas{
    background:#1e1e1e;
}
</style>
</head>

<body>
<div class="container">
<h2>Foot Care Training</h2>

<div style="text-align:center;margin-bottom:20px;">
<button onclick="toggleDarkMode()">üåô Dark Mode</button>
</div>

<div class="cards">
    <div class="card">
        <div>Dorsi</div>
        <div class="big" id="dorsiVal">0</div>
        <button onclick="startDorsi()">Start Dorsi</button>
    </div>

    <div class="card">
        <div>Plantar</div>
        <div class="big" id="plantarVal">0</div>
        <button onclick="startPlantar()">Start Plantar</button>
    </div>
</div>

<div class="xyz-box">
    <div class="xyz">X<br><span id="xVal">0</span></div>
    <div class="xyz">Y<br><span id="yVal">0</span></div>
    <div class="xyz">Z<br><span id="zVal">0</span></div>
</div>

<div class="timer">
‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤: <span id="timer">30</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
</div>

<table>
<thead>
<tr>
<th>‡πÄ‡∏ã‡∏ó</th>
<th>Dorsi Max</th>
<th>Plantar Max</th>
<th>ROM</th>
</tr>
</thead>
<tbody id="resultTable">
<tr><td>1</td><td>-</td><td>-</td><td>-</td></tr>
<tr><td>2</td><td>-</td><td>-</td><td>-</td></tr>
<tr><td>3</td><td>-</td><td>-</td><td>-</td></tr>
<tr><td>4</td><td>-</td><td>-</td><td>-</td></tr>
<tr><td>5</td><td>-</td><td>-</td><td>-</td></tr>
</tbody>
</table>

<canvas id="liveChart" height="120"></canvas>
<canvas id="summaryChart" height="120"></canvas>

</div>

<script>
let timerEl=document.getElementById("timer");
let dorsiVal=document.getElementById("dorsiVal");
let plantarVal=document.getElementById("plantarVal");
let xVal=document.getElementById("xVal");
let yVal=document.getElementById("yVal");
let zVal=document.getElementById("zVal");
let table=document.getElementById("resultTable");

let interval;
let timeLeft=30;
let currentSet=0;

let maxDorsi=0;
let maxPlantar=0;

const liveChart=new Chart(document.getElementById("liveChart"),{
    type:"line",
    data:{labels:[],datasets:[
        {label:"Dorsi",data:[],borderWidth:2},
        {label:"Plantar",data:[],borderWidth:2}
    ]}
});

const summaryChart=new Chart(document.getElementById("summaryChart"),{
    type:"bar",
    data:{labels:[],datasets:[
        {label:"Dorsi Max",data:[],borderWidth:1},
        {label:"Plantar Max",data:[],borderWidth:1},
        {label:"ROM",data:[],borderWidth:1}
    ]}
});

function toggleDarkMode(){
    document.body.classList.toggle("dark");
}

function resetXYZ(){
    xVal.innerText=0;
    yVal.innerText=0;
    zVal.innerText=0;
}

function clearLiveChart(){
    liveChart.data.labels=[];
    liveChart.data.datasets[0].data=[];
    liveChart.data.datasets[1].data=[];
    liveChart.update();
}

function simulateMPU(){
    let x=Math.random()*40-20;
    let y=Math.random()*50-25;
    let z=Math.random()*30-15;

    xVal.innerText=x.toFixed(1);
    yVal.innerText=y.toFixed(1);
    zVal.innerText=z.toFixed(1);

    return {x,y,z};
}

function startDorsi(){
    runTraining("dorsi");
}

function startPlantar(){
    runTraining("plantar");
}

function runTraining(type){
    if(currentSet>=5) return;

    clearInterval(interval);
    clearLiveChart();   // üî• ‡∏•‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà

    timeLeft=30;
    timerEl.innerText=timeLeft;

    maxDorsi=0;
    maxPlantar=0;

    interval=setInterval(()=>{
        timeLeft--;
        timerEl.innerText=timeLeft;

        let {x,y,z}=simulateMPU();
        let value=(type==="dorsi")?x:y;

        if(type==="dorsi"){
            dorsiVal.innerText=value.toFixed(1);
            if(Math.abs(value)>maxDorsi) maxDorsi=Math.abs(value);
        }

        if(type==="plantar"){
            plantarVal.innerText=value.toFixed(1);
            if(Math.abs(value)>maxPlantar) maxPlantar=Math.abs(value);
        }

        liveChart.data.labels.push(30-timeLeft);
        if(type==="dorsi"){
            liveChart.data.datasets[0].data.push(value);
            liveChart.data.datasets[1].data.push(null);
        }else{
            liveChart.data.datasets[0].data.push(null);
            liveChart.data.datasets[1].data.push(value);
        }

        liveChart.update();

        if(timeLeft<=0){
            clearInterval(interval);
            clearLiveChart();   // üî• ‡∏•‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö
            finishSet();
        }
    },1000);
}

function finishSet(){
    let rom=maxDorsi+maxPlantar;

    table.rows[currentSet].cells[1].innerText=maxDorsi.toFixed(1);
    table.rows[currentSet].cells[2].innerText=maxPlantar.toFixed(1);
    table.rows[currentSet].cells[3].innerText=rom.toFixed(1);

    summaryChart.data.labels.push("‡πÄ‡∏ã‡∏ó "+(currentSet+1));
    summaryChart.data.datasets[0].data.push(maxDorsi);
    summaryChart.data.datasets[1].data.push(maxPlantar);
    summaryChart.data.datasets[2].data.push(rom);
    summaryChart.update();

    currentSet++;
    resetXYZ();
}
</script>

</body>
</html>
