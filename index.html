<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Foot Care Training</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:20px;
}
h2{text-align:center;}

.container{
    max-width:1000px;
    margin:auto;
}

.cards{
    display:flex;
    gap:20px;
    justify-content:center;
    margin-bottom:20px;
}

.card{
    background:white;
    border-radius:12px;
    padding:20px;
    width:200px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.big{
    font-size:32px;
    font-weight:bold;
    margin:10px 0;
}

button{
    background:#007bff;
    color:white;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    cursor:pointer;
}
button:hover{background:#0056b3;}

.timer{
    text-align:center;
    font-size:28px;
    margin:20px 0;
}

table{
    width:100%;
    border-collapse:collapse;
    background:white;
    margin-top:20px;
}
th,td{
    border:1px solid #ccc;
    padding:10px;
    text-align:center;
}
th{
    background:#007bff;
    color:white;
}

canvas{
    background:white;
    margin-top:30px;
    padding:10px;
    border-radius:12px;
}
</style>
</head>

<body>
<div class="container">
<h2>Foot Care Training</h2>

<div class="cards">
    <div class="card">
        <div>ยกเท้า (Dorsi)</div>
        <div class="big"><span id="dorsiSet">0</span> / 5</div>
        <button onclick="startSet('dorsi')">เริ่มยกเท้า</button>
    </div>

    <div class="card">
        <div>เหยียดเท้า (Plantar)</div>
        <div class="big"><span id="plantarSet">0</span> / 5</div>
        <button onclick="startSet('plantar')">เริ่มเหยียดเท้า</button>
    </div>
</div>

<div class="timer">
⏱️ เวลา: <span id="timer">30</span> วินาที
</div>

<table>
<thead>
<tr>
<th>เซท</th>
<th>Dorsi</th>
<th>Plantar</th>
</tr>
</thead>
<tbody id="resultTable">
<tr><td>1</td><td>-</td><td>-</td></tr>
<tr><td>2</td><td>-</td><td>-</td></tr>
<tr><td>3</td><td>-</td><td>-</td></tr>
<tr><td>4</td><td>-</td><td>-</td></tr>
<tr><td>5</td><td>-</td><td>-</td></tr>
</tbody>
</table>

<h3 style="text-align:center;margin-top:40px;">กราฟสรุปผลแต่ละเซท</h3>
<canvas id="summaryChart" height="120"></canvas>

<h3 style="text-align:center;margin-top:40px;">กราฟการเคลื่อนไหวใน 30 วินาที</h3>
<canvas id="progressChart" height="120"></canvas>

</div>

<script>

let dorsiSet = 0;
let plantarSet = 0;
let timeLeft = 30;
let timer;

const timerEl = document.getElementById("timer");
const dorsiSetEl = document.getElementById("dorsiSet");
const plantarSetEl = document.getElementById("plantarSet");
const tableEl = document.getElementById("resultTable");

const summaryChart = new Chart(document.getElementById("summaryChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            { label: "Dorsi", data: [], borderWidth:2 },
            { label: "Plantar", data: [], borderWidth:2 }
        ]
    }
});

const progressChart = new Chart(document.getElementById("progressChart"), {
    type: "line",
    data: {
        labels: [],
        datasets: [
            { label: "Dorsi ต่อวินาที", data: [], borderWidth:2 },
            { label: "Plantar ต่อวินาที", data: [], borderWidth:2 }
        ]
    }
});

function startSet(mode){

    if(mode==="dorsi" && dorsiSet>=5) return;
    if(mode==="plantar" && plantarSet>=5) return;

    clearInterval(timer);

    timeLeft = 30;
    timerEl.innerText = timeLeft;

    progressChart.data.labels = [];
    progressChart.data.datasets[0].data = [];
    progressChart.data.datasets[1].data = [];
    progressChart.update();

    let second = 0;

    timer = setInterval(()=>{

        timeLeft--;
        second++;
        timerEl.innerText = timeLeft;

        // จำลองค่าต่อวินาที
        let dorsiNow = Math.floor(Math.random()*20)+10;
        let plantarNow = Math.floor(Math.random()*30)+20;

        progressChart.data.labels.push(second);
        progressChart.data.datasets[0].data.push(dorsiNow);
        progressChart.data.datasets[1].data.push(plantarNow);
        progressChart.update();

        if(timeLeft<=0){
            clearInterval(timer);
            finishSet(mode);
        }

    },1000);
}

function finishSet(mode){

    let dorsi = Math.floor(Math.random()*20)+10;
    let plantar = Math.floor(Math.random()*30)+20;

    let rowIndex;

    if(mode==="dorsi"){
        dorsiSet++;
        dorsiSetEl.innerText = dorsiSet;
        rowIndex = dorsiSet-1;
        tableEl.rows[rowIndex].cells[1].innerText = dorsi;
    }

    if(mode==="plantar"){
        plantarSet++;
        plantarSetEl.innerText = plantarSet;
        rowIndex = plantarSet-1;
        tableEl.rows[rowIndex].cells[2].innerText = plantar;
    }

    let dVal = tableEl.rows[rowIndex].cells[1].innerText;
    let pVal = tableEl.rows[rowIndex].cells[2].innerText;

    if(dVal!=="-" && pVal!=="-"){
        summaryChart.data.labels.push("เซท "+(rowIndex+1));
        summaryChart.data.datasets[0].data.push(dVal);
        summaryChart.data.datasets[1].data.push(pVal);
        summaryChart.update();
    }
}

</script>

</body>
</html>
